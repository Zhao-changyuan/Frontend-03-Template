
## 浏览器：一个浏览器是如何工作的？（阶段一）

学习浏览器的的内部工作原理和个中缘由，对于我们做性能优化、排查错误都有很大的好处。

浏览器的工作过程：
1. 浏览器首先使用HTTP协议或者HTTPS协议，项服务端请求页面；
2. 把请求回来的HTML代码经过解析，构建成DOM树；
3. 计算DOM树上的CSS属性；
4. 最后根据CSS属性对元素逐个进行渲染，得到内存中的位图；
5. 一个可选的步骤是对位图进行合成，这会极大地增加后续绘制的速度；
6. 合成之后，再绘制到界面上。

从HTTP请求回来，就产生了流式的数据，后续的DOM树构建、CSS计算、渲染、合成、绘制，
都是尽可能地流式处理前一步的产出：既不需要等到上一步骤完全结束，就开始处理上一步的
输出，这样我们在浏览网页时，才会看到逐步出现的页面。

**HTTP协议**

**HTTPS**
HTTPS是使用加密通道来传输HTTP的内容。但是HTTPS首先与服务端建立一条TLS加密通道。
TLS构建于TCP协议之上，它实际上是对传输的内容做一次加密，所以从传输内容上看，HTTPS跟
HTTP没有任何区别。

## 浏览器：一个浏览器是如何工作的？（阶段二）

状态机真的是一种没办法封装的东西，所以我们永远不要试图封装状态机。

## 浏览器：一个浏览器是如何工作的？（阶段三）

依次拿到上一步构造好的元素，去检查它匹配到了哪些规则，在根据规则的优先级，做覆盖和调整。
所以从这个角度看，所谓的选择器，应该被理解成“匹配器”才更合适。

选择器的出现顺序，必定跟构建DOM树的顺序一致。这是一个CSS设计的原则，即保证选择器在DOM树构建到
当前节点时，已经可以准确判断是否匹配，不需要后续节点信息。

## 浏览器：一个浏览器是如何工作的？（阶段四）
**基本概念**
浏览器最基本的排版方案是正常流排版，它包含了顺次排布和折行等规则。

**正常流文字排版**
正常流是唯一一个文字和盒混排的排版方式。

**正常流中的盒**
浏览器对行的排版，一般是先行内布局，在确定行的位置根据行的位置计算出行内盒和文字的排版位置。

块级盒比较简单，它总是单独占据一整行，计算出交叉轴方向的高度。

**绝对定位元素**
position属性为absolute的元素，我们需要根据它的包含块来确定位置。这是完全跟正常流无关
的一种独立排版模式，逐层找到其父级的position非static元素即可。

**浮动元素排版**
float元素非常特别，浏览器对float的处理是先排入正常流，在移动到排版宽度的最左/最右（这里实际上是主轴的最前和最后）。

**其他的排版**
浏览器支持的每一种排版方式，都是按照对应的标准来实现的。

## 浏览器：一个浏览器是如何工作的？（阶段五）

**渲染**
本文中的“渲染”一词，统一指的是它在图形学的意义， 也就是把模型变成位图的过程。

**合成**
合成是一个性能考量，那么合成的目标就是提高性能，更具这个目标，我们建立的原则就是
最大限度减少绘制次数原则。

**绘制**
绘制是把“位图最终绘制到屏幕上，变成肉眼可见的图像”的过程。

计算机图形学中，我们使用的方案就是“脏矩形”算法，也就是把屏幕均匀地分成若干区域。

当鼠标移动、元素移动或者其他导致需要重绘的场景发生时，我们只重绘它所影响到的几个矩形区域就够了。

我们重新绘制脏矩形区域时，把所有与矩形区域有交集的合成层（位图）的交集部分绘制即可。


